console.log("-- Init Skenaariopeli applogic.js - version 4");

miro.onReady(async function() {
  const authorized = await miro.isAuthorized();
  if (authorized) {
    console.log("Authorized")
    initialize();
  } else {
    console.log("Not authorized")
    miro.board.ui.openModal('skenaariopeli/not-authorized.html')
      .then(res => {
        if (res === 'success') {
          initialize();
        }
      })
  }
})

function initialize() {
  miro.initialize({
    extensionPoints: {
      bottomBar: {
        title: 'Skenaariopeli',
        svgIcon: '<path d="M6.815 18.208c1.002 0 1.868-.166 2.598-.498.73-.332 1.286-.791 1.665-1.378.379-.587.568-1.248.568-1.984 0-.614-.109-1.133-.328-1.556-.218-.424-.523-.774-.913-1.05s-.863-.512-1.42-.706-1.176-.37-1.863-.531c-.547-.138-.94-.244-1.178-.316s-.473-.171-.706-.298c-.232-.128-.415-.28-.548-.457s-.199-.387-.199-.63c0-.394.195-.73.585-1.01.39-.279.904-.418 1.54-.418.686 0 1.184.128 1.494.386s.576.615.797 1.075c.172.32.33.552.477.693.147.14.361.211.644.211.31 0 .568-.117.776-.352.207-.236.311-.5.311-.793 0-.321-.083-.65-.249-.988-.166-.338-.429-.66-.789-.967-.36-.307-.812-.553-1.357-.739-.545-.185-1.19-.278-1.938-.278-.935 0-1.749.14-2.44.42-.692.279-1.22.679-1.586 1.199a3.03 3.03 0 00-.548 1.785c0 .702.173 1.29.52 1.763.345.474.813.847 1.402 1.121.59.274 1.321.513 2.196.718.653.15 1.174.29 1.564.423.39.133.709.326.955.577.246.252.37.58.37.984 0 .51-.229.934-.686 1.274-.456.34-1.05.51-1.78.51-.531 0-.96-.084-1.287-.253a2.036 2.036 0 01-.76-.643 4.936 4.936 0 01-.501-.971c-.128-.327-.281-.573-.461-.739s-.4-.249-.66-.249a1.06 1.06 0 00-.793.32 1.061 1.061 0 00-.31.768c0 .514.172 1.044.518 1.59.346.544.795.98 1.349 1.307.78.453 1.77.68 2.971.68zm7.75 0c.354 0 .647-.127.88-.382s.349-.628.349-1.12V13.26h2.257c1.511 0 2.648-.32 3.412-.959.764-.64 1.145-1.578 1.145-2.818 0-.581-.094-1.104-.282-1.569a3.106 3.106 0 00-.826-1.179 3.213 3.213 0 00-1.29-.689c-.504-.143-1.224-.215-2.159-.215H14.89c-.543 0-.938.116-1.187.348-.25.233-.374.62-.374 1.162v9.38c0 .487.114.857.34 1.108.227.252.526.378.897.378zm2.889-6.807h-1.66V7.683h1.66c1.1 0 1.829.18 2.183.54.315.337.473.774.473 1.31 0 .449-.102.811-.307 1.088s-.502.476-.893.598-.875.182-1.456.182zM23 1v2H1V1zM23 21v2H1v-2z"/>',
        onClick: () => {
          miro.board.ui.openLeftSidebar('skenaariopeli/sidebar.html');
        }
      }
    }
  });
  miro.board.ui.openLeftSidebar('skenaariopeli/sidebar.html');
}

function updateViewport() {
  console.log("Debug");
}
